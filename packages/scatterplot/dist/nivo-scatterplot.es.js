import{useMemo as e,useCallback as n,createElement as o,Fragment as i,useRef as t,useState as r,useEffect as a}from"react";import{useValueFormatter as d,usePropertyAccessor as s,useMotionConfig as l,Container as u,useDimensions as c,CartesianMarkers as h,SvgWrapper as f,ResponsiveWrapper as v,useTheme as m,getRelativeCursor as g,isCursorInRect as p}from"@nivo/core";import{Grid as y,Axes as x,renderGridLinesToCanvas as M,renderAxesToCanvas as S}from"@nivo/axes";import{BoxLegendSvg as b,renderLegendToCanvas as w}from"@nivo/legends";import{useOrdinalColorScale as I}from"@nivo/colors";import{computeXYScalesForSeries as k}from"@nivo/scales";import{useAnnotations as z,Annotation as E,renderAnnotationsToCanvas as C}from"@nivo/annotations";import L from"lodash/get";import W from"lodash/isString";import F from"lodash/isNumber";import X from"lodash/isPlainObject";import{scaleLinear as Y}from"d3-scale";import{animated as B,useTransition as G}from"@react-spring/web";import{jsx as H,Fragment as T}from"react/jsx-runtime";import{BasicTooltip as V,useTooltip as R}from"@nivo/tooltip";import{Mesh as j,useVoronoiMesh as D,renderVoronoiToCanvas as N,renderVoronoiCellToCanvas as O}from"@nivo/voronoi";function P(){return P=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},P.apply(this,arguments)}function A(e,n){if(null==e)return{};var o,i,t={},r=Object.keys(e);for(i=0;i<r.length;i++)o=r[i],n.indexOf(o)>=0||(t[o]=e[o]);return t}var U=function(e){if("function"==typeof e)return e;if(F(e))return function(){return e};if(function(e){return X(e)}(e)){if(!W(e.key))throw new Error("symbolSize is invalid, key should be a string pointing to the property to use to determine node size");if(!Array.isArray(e.values)||2!==e.values.length)throw new Error("symbolSize is invalid, values spec should be an array containing two values, min and max");if(!Array.isArray(e.sizes)||2!==e.sizes.length)throw new Error("symbolSize is invalid, sizes spec should be an array containing two values, min and max");var n=Y().domain([e.values[0],e.values[1]]).range([e.sizes[0],e.sizes[1]]);return function(o){return n(L(o,e.key))}}throw new Error("nodeSize is invalid, it should be either a function, a number or an object")},q=function(n){var o,i=n.data,t=n.xScaleSpec,r=n.xFormat,a=n.yScaleSpec,l=n.yFormat,u=n.width,c=n.height,h=n.nodeId,f=n.nodeSize,v=n.colors,m=e((function(){return k(i,t,a,u,c)}),[i,t,a,u,c]),g=m.series,p=m.xScale,y=m.yScale,x=d(r),M=d(l),S=s(h),b=e((function(){return function(e){var n=e.series,o=e.formatX,i=e.formatY,t=e.getNodeId,r=[];return n.forEach((function(e){e.data.forEach((function(n,a){var d={index:r.length,serieIndex:a,serieId:e.id,x:n.position.x,xValue:n.data.x,formattedX:o(n.data.x),y:n.position.y,yValue:n.data.y,formattedY:i(n.data.y),data:n.data};r.push(P({},d,{id:t(d)}))}))})),r}({series:g,formatX:x,formatY:M,getNodeId:S})}),[g,x,M,S]),w=e((function(){return U(o)}),[o=f]),z=I(v,"serieId");return{xScale:p,yScale:y,nodes:e((function(){return b.map((function(e){return P({},e,{size:w(e),color:z({serieId:e.serieId})})}))}),[b,w,z]),legendData:e((function(){return g.map((function(e){return{id:e.id,label:e.id,color:z({serieId:e.id})}}))}),[g,z])}},J=function(e,n){return z({data:e,annotations:n,getPosition:function(e){return{x:e.x,y:e.y}},getDimensions:function(e){return{size:e.size,width:e.size,height:e.size}}})},K=function(e){return e/2},Q={xScale:{type:"linear",min:0,max:"auto"},yScale:{type:"linear",min:0,max:"auto"},enableGridX:!0,enableGridY:!0,axisBottom:{},axisLeft:{},nodeId:function(e){return e.serieId+"."+e.index},nodeSize:9,nodeComponent:function(e){var o=e.node,i=e.style,t=e.blendMode,r=e.isInteractive,a=e.onMouseEnter,d=e.onMouseMove,s=e.onMouseLeave,l=e.onClick,u=n((function(e){return null==a?void 0:a(o,e)}),[o,a]),c=n((function(e){return null==d?void 0:d(o,e)}),[o,d]),h=n((function(e){return null==s?void 0:s(o,e)}),[o,s]),f=n((function(e){return null==l?void 0:l(o,e)}),[o,l]);return H(B.circle,{cx:i.x,cy:i.y,r:i.size.to(K),fill:i.color,style:{mixBlendMode:t},onMouseEnter:r?u:void 0,onMouseMove:r?c:void 0,onMouseLeave:r?h:void 0,onClick:r?f:void 0})},colors:{scheme:"nivo"},isInteractive:!0,debugMesh:!1,tooltip:function(e){var n=e.node;return H(V,{id:n.serieId,value:"x: "+n.formattedX+", y: "+n.formattedY,enableChip:!0,color:n.color})},markers:[],legends:[],annotations:[]},Z=P({},Q,{blendMode:"normal",layers:["grid","axes","nodes","markers","mesh","legends","annotations"],role:"img",useMesh:!0,animate:!0,motionConfig:"default"}),$=P({},Q,{layers:["grid","axes","nodes","mesh","legends","annotations"],pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,renderNode:function(e,n){e.beginPath(),e.arc(n.x,n.y,n.size/2,0,2*Math.PI),e.fillStyle=n.color,e.fill()}}),_=function(e){var n=e.nodes,o=e.annotations,i=J(n,o);return H(T,{children:i.map((function(e,n){return H(E,P({},e),n)}))})},ee=function(e){return e.id},ne=function(e){return{x:e.x,y:e.y,size:e.size,color:e.color}},oe=function(e){return{x:e.x,y:e.y,size:0,color:e.color}},ie=function(e){var i=e.nodes,t=e.nodeComponent,r=e.isInteractive,a=e.onMouseEnter,d=e.onMouseMove,s=e.onMouseLeave,u=e.onClick,c=e.tooltip,h=e.blendMode,f=l(),v=f.animate,m=f.config,g=G(i,{keys:ee,from:ne,enter:ne,update:ne,leave:oe,config:m,immediate:!v}),p=R(),y=p.showTooltipFromEvent,x=p.hideTooltip,M=n((function(e,n){y(o(c,{node:e}),n),null==a||a(e,n)}),[c,y,a]),S=n((function(e,n){y(o(c,{node:e}),n),null==d||d(e,n)}),[c,y,d]),b=n((function(e,n){x(),null==s||s(e,n)}),[x,s]),w=n((function(e,n){return null==u?void 0:u(e,n)}),[u]);return H(T,{children:g((function(e,n){return o(t,{node:n,style:e,blendMode:h,isInteractive:r,onMouseEnter:r?M:void 0,onMouseMove:r?S:void 0,onMouseLeave:r?b:void 0,onClick:r?w:void 0})}))})},te=function(e){var i=e.nodes,t=e.width,r=e.height,a=e.onMouseEnter,d=e.onMouseMove,s=e.onMouseLeave,l=e.onClick,u=e.tooltip,c=e.debug,h=R(),f=h.showTooltipFromEvent,v=h.hideTooltip,m=n((function(e,n){f(o(u,{node:e}),n),a&&a(e,n)}),[f,u,a]),g=n((function(e,n){f(o(u,{node:e}),n),d&&d(e,n)}),[f,u,d]),p=n((function(e,n){v(),s&&s(e,n)}),[v,s]),y=n((function(e,n){l&&l(e,n)}),[l]);return H(j,{nodes:i,width:t,height:r,onMouseEnter:m,onMouseMove:g,onMouseLeave:p,onClick:y,debug:c})},re=["isInteractive","animate","motionConfig","theme","renderWrapper"],ae=function(n){var t=n.data,r=n.xScale,a=void 0===r?Z.xScale:r,d=n.xFormat,s=n.yScale,l=void 0===s?Z.yScale:s,u=n.yFormat,v=n.width,m=n.height,g=n.margin,p=n.layers,M=void 0===p?Z.layers:p,S=n.colors,w=void 0===S?Z.colors:S,I=n.blendMode,k=void 0===I?Z.blendMode:I,z=n.nodeId,E=void 0===z?Z.nodeId:z,C=n.nodeSize,L=void 0===C?Z.nodeSize:C,W=n.nodeComponent,F=void 0===W?Z.nodeComponent:W,X=n.enableGridX,Y=void 0===X?Z.enableGridX:X,B=n.enableGridY,G=void 0===B?Z.enableGridY:B,T=n.gridXValues,V=n.gridYValues,R=n.axisTop,j=n.axisRight,D=n.axisBottom,N=void 0===D?Z.axisBottom:D,O=n.axisLeft,A=void 0===O?Z.axisLeft:O,U=n.annotations,J=void 0===U?Z.annotations:U,K=n.isInteractive,Q=void 0===K?Z.isInteractive:K,$=n.useMesh,ee=void 0===$?Z.useMesh:$,ne=n.debugMesh,oe=void 0===ne?Z.debugMesh:ne,re=n.onMouseEnter,ae=n.onMouseMove,de=n.onMouseLeave,se=n.onClick,le=n.tooltip,ue=void 0===le?Z.tooltip:le,ce=n.markers,he=void 0===ce?Z.markers:ce,fe=n.legends,ve=void 0===fe?Z.legends:fe,me=n.role,ge=void 0===me?Z.role:me,pe=n.ariaLabel,ye=n.ariaLabelledBy,xe=n.ariaDescribedBy,Me=c(v,m,g),Se=Me.margin,be=Me.innerWidth,we=Me.innerHeight,Ie=Me.outerWidth,ke=Me.outerHeight,ze=q({data:t,xScaleSpec:a,xFormat:d,yScaleSpec:l,yFormat:u,width:be,height:we,nodeId:E,nodeSize:L,colors:w}),Ee=ze.xScale,Ce=ze.yScale,Le=ze.nodes,We=ze.legendData,Fe=e((function(){return{xScale:Ee,yScale:Ce,nodes:Le,margin:Se,innerWidth:be,innerHeight:we,outerWidth:Ie,outerHeight:ke}}),[Ee,Ce,Le,Se,be,we,Ie,ke]),Xe={grid:null,axes:null,nodes:null,markers:null,mesh:null,annotations:null,legends:null};return M.includes("grid")&&(Xe.grid=H(y,{width:be,height:we,xScale:Y?Ee:null,yScale:G?Ce:null,xValues:T,yValues:V},"grid")),M.includes("axes")&&(Xe.axes=H(x,{xScale:Ee,yScale:Ce,width:be,height:we,top:R,right:j,bottom:N,left:A},"axes")),M.includes("nodes")&&(Xe.nodes=H(ie,{nodes:Le,nodeComponent:F,isInteractive:Q,tooltip:ue,blendMode:k,onMouseEnter:re,onMouseMove:ae,onMouseLeave:de,onClick:se},"nodes")),M.includes("markers")&&(Xe.markers=H(h,{markers:he,width:be,height:we,xScale:Ee,yScale:Ce},"markers")),M.includes("mesh")&&Q&&ee&&(Xe.mesh=H(te,{nodes:Le,width:be,height:we,onMouseEnter:re,onMouseMove:ae,onMouseLeave:de,onClick:se,tooltip:ue,debug:oe},"mesh")),M.includes("annotations")&&(Xe.annotations=H(_,{nodes:Le,annotations:J},"annotations")),M.includes("legends")&&(Xe.legends=ve.map((function(e,n){return H(b,P({},e,{containerWidth:be,containerHeight:we,data:We}),n)}))),H(f,{width:Ie,height:ke,margin:Se,role:ge,ariaLabel:pe,ariaLabelledBy:ye,ariaDescribedBy:xe,children:M.map((function(e,n){if("string"==typeof e&&void 0!==Xe[e])return Xe[e];if("function"==typeof e)return H(i,{children:o(e,Fe)},n);throw new Error("Unknown layer ("+e+")")}))})},de=function(e){var n=e.isInteractive,o=void 0===n?Z.isInteractive:n,i=e.animate,t=void 0===i?Z.animate:i,r=e.motionConfig,a=void 0===r?Z.motionConfig:r,d=e.theme,s=e.renderWrapper,l=A(e,re);return H(u,{animate:t,isInteractive:o,motionConfig:a,renderWrapper:s,theme:d,children:H(ae,P({isInteractive:o},l))})},se=function(e){return H(v,{children:function(n){var o=n.width,i=n.height;return H(de,P({width:o,height:i},e))}})},le=["isInteractive","renderWrapper","theme"],ue=function(i){var d=i.data,s=i.xScale,l=void 0===s?$.xScale:s,u=i.xFormat,h=i.yScale,f=void 0===h?$.yScale:h,v=i.yFormat,y=i.width,x=i.height,b=i.margin,I=i.pixelRatio,k=void 0===I?$.pixelRatio:I,z=i.layers,E=void 0===z?$.layers:z,L=i.colors,W=void 0===L?$.colors:L,F=i.nodeId,X=void 0===F?Z.nodeId:F,Y=i.nodeSize,B=void 0===Y?$.nodeSize:Y,G=i.renderNode,T=void 0===G?$.renderNode:G,V=i.enableGridX,j=void 0===V?$.enableGridX:V,A=i.gridXValues,U=i.enableGridY,K=void 0===U?$.enableGridY:U,Q=i.gridYValues,_=i.axisTop,ee=i.axisRight,ne=i.axisBottom,oe=void 0===ne?$.axisBottom:ne,ie=i.axisLeft,te=void 0===ie?$.axisLeft:ie,re=i.annotations,ae=void 0===re?$.annotations:re,de=i.isInteractive,se=void 0===de?$.isInteractive:de,le=i.debugMesh,ue=void 0===le?$.debugMesh:le,ce=i.onMouseEnter,he=i.onMouseMove,fe=i.onMouseLeave,ve=i.onClick,me=i.tooltip,ge=void 0===me?$.tooltip:me,pe=i.legends,ye=void 0===pe?$.legends:pe,xe=t(null),Me=m(),Se=r(null),be=Se[0],we=Se[1],Ie=c(y,x,b),ke=Ie.margin,ze=Ie.innerWidth,Ee=Ie.innerHeight,Ce=Ie.outerWidth,Le=Ie.outerHeight,We=q({data:d,xScaleSpec:l,xFormat:u,yScaleSpec:f,yFormat:v,width:ze,height:Ee,nodeId:X,nodeSize:B,colors:W}),Fe=We.xScale,Xe=We.yScale,Ye=We.nodes,Be=We.legendData,Ge=J(Ye,ae),He=D({points:Ye,width:ze,height:Ee,debug:ue}),Te=He.delaunay,Ve=He.voronoi,Re=e((function(){return{xScale:Fe,yScale:Xe,nodes:Ye,margin:ke,innerWidth:ze,innerHeight:Ee,outerWidth:Ce,outerHeight:Le}}),[Fe,Xe,Ye,ke,ze,Ee,Ce,Le]);a((function(){if(xe.current){xe.current.width=Ce*k,xe.current.height=Le*k;var e=xe.current.getContext("2d");e.scale(k,k),e.fillStyle=Me.background,e.fillRect(0,0,Ce,Le),e.translate(ke.left,ke.top),E.forEach((function(n){if("grid"===n)e.lineWidth=Me.grid.line.strokeWidth,e.strokeStyle=Me.grid.line.stroke,j&&M(e,{width:ze,height:Ee,scale:Fe,axis:"x",values:A}),K&&M(e,{width:ze,height:Ee,scale:Xe,axis:"y",values:Q});else if("annotations"===n)C(e,{annotations:Ge,theme:Me});else if("axes"===n)S(e,{xScale:Fe,yScale:Xe,width:ze,height:Ee,top:_,right:ee,bottom:oe,left:te,theme:Me});else if("nodes"===n)Ye.forEach((function(n){T(e,n)}));else if("mesh"===n)ue&&(N(e,Ve),be&&O(e,Ve,be.index));else if("legends"===n)ye.forEach((function(n){w(e,P({},n,{data:Be,containerWidth:ze,containerHeight:Ee,theme:Me}))}));else{if("function"!=typeof n)throw new Error("Invalid layer: "+n);n(e,Re)}}))}}),[xe,ze,Ee,Ce,Le,ke.top,ke.left,k,T,E,Re,Me,Fe,Xe,Ye,j,K,_,ee,oe,te,ye,Be,ue,Ve,be,Ge]);var je=R(),De=je.showTooltipFromEvent,Ne=je.hideTooltip,Oe=n((function(e){var n=g(xe.current,e),o=n[0],i=n[1];if(!p(ke.left,ke.top,ze,Ee,o,i))return null;var t=Te.find(o-ke.left,i-ke.top);return Ye[t]}),[xe,ke,ze,Ee,Te]),Pe=n((function(e){var n=Oe(e);we(n),n?(De(o(ge,{node:n}),e),be&&be.id!==n.id&&(fe&&fe(be,e),ce&&ce(n,e)),be||ce&&ce(n,e),he&&he(n,e)):(Ne(),be&&fe&&fe(be,e))}),[Oe,be,we,De,Ne,ge,ce,he,fe]),Ae=n((function(e){Ne(),we(null),be&&fe&&fe(be,e)}),[Ne,be,we,fe]),Ue=n((function(e){if(ve){var n=Oe(e);n&&ve(n,e)}}),[Oe,ve]);return H("canvas",{ref:xe,width:Ce*k,height:Le*k,style:{width:Ce,height:Le,cursor:se?"auto":"normal"},onMouseEnter:se?Pe:void 0,onMouseMove:se?Pe:void 0,onMouseLeave:se?Ae:void 0,onClick:se?Ue:void 0})},ce=function(e){var n=e.isInteractive,o=e.renderWrapper,i=e.theme,t=A(e,le);return H(u,{isInteractive:n,renderWrapper:o,theme:i,animate:!1,children:H(ue,P({},t))})},he=function(e){return H(v,{children:function(n){var o=n.width,i=n.height;return H(ce,P({width:o,height:i},e))}})};export{se as ResponsiveScatterPlot,he as ResponsiveScatterPlotCanvas,de as ScatterPlot,ce as ScatterPlotCanvas,$ as canvasDefaultProps,Q as commonDefaultProps,Z as svgDefaultProps,q as useScatterPlot,J as useScatterPlotAnnotations};
//# sourceMappingURL=nivo-scatterplot.es.js.map
