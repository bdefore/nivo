import e from"lodash/uniq";import{useState as o,useMemo as n,useCallback as t,createElement as i,Fragment as r}from"react";import{useTheme as l,usePropertyAccessor as a,useValueFormatter as d,useMotionConfig as c,useAnimatedPath as s,Container as u,useDimensions as h,SvgWrapper as v,ResponsiveWrapper as p}from"@nivo/core";import{BoxLegendSvg as g}from"@nivo/legends";import{sankeyCenter as f,sankeyJustify as y,sankeyLeft as m,sankeyRight as k,sankey as b}from"d3-sankey";import{BasicTooltip as C,Chip as x,useTooltip as O}from"@nivo/tooltip";import{jsx as L,jsxs as M,Fragment as T}from"react/jsx-runtime";import w from"lodash/cloneDeep";import{useOrdinalColorScale as B,useInheritedColor as I}from"@nivo/colors";import{useSpring as H,animated as P,useSprings as W}from"@react-spring/web";import{line as N,curveMonotoneX as F,curveMonotoneY as R}from"d3-shape";function S(){return S=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},S.apply(this,arguments)}var z={container:{display:"flex",alignItems:"center"},sourceChip:{marginRight:7},targetChip:{marginLeft:7,marginRight:7}},E={center:f,justify:y,start:m,end:k},G=Object.keys(E),j=function(e){return E[e]},D={layout:"horizontal",align:"center",sort:"auto",colors:{scheme:"nivo"},nodeOpacity:.75,nodeHoverOpacity:1,nodeHoverOthersOpacity:.15,nodeThickness:12,nodeSpacing:12,nodeInnerPadding:0,nodeBorderWidth:1,nodeBorderColor:{from:"color",modifiers:[["darker",.5]]},nodeBorderRadius:0,linkOpacity:.25,linkHoverOpacity:.6,linkHoverOthersOpacity:.15,linkContract:0,linkBlendMode:"multiply",enableLinkGradient:!1,enableLabels:!0,label:"id",labelPosition:"inside",labelPadding:9,labelOrientation:"horizontal",labelTextColor:{from:"color",modifiers:[["darker",.8]]},isInteractive:!0,nodeTooltip:function(e){var o=e.node;return L(C,{id:o.label,enableChip:!0,color:o.color})},linkTooltip:function(e){var o=e.link;return L(C,{id:M("span",{style:z.container,children:[L(x,{color:o.source.color,style:z.sourceChip}),L("strong",{children:o.source.label})," > ",L("strong",{children:o.target.label}),L(x,{color:o.target.color,style:z.targetChip}),L("strong",{children:o.formattedValue})]})})},legends:[],layers:["links","nodes","labels","legends"],role:"img",animate:!0,motionConfig:"gentle"},V=function(e){return e.id},A=function(e){var t=e.data,i=e.valueFormat,r=e.layout,c=e.width,s=e.height,u=e.sort,h=e.align,v=e.colors,p=e.nodeThickness,g=e.nodeSpacing,f=e.nodeInnerPadding,y=e.nodeBorderColor,m=e.label,k=e.labelTextColor,C=o(null),x=C[0],O=C[1],L=o(null),M=L[0],T=L[1],H=n((function(){if("auto"!==u)return"input"===u?null:"ascending"===u?function(e,o){return e.value-o.value}:"descending"===u?function(e,o){return o.value-e.value}:u}),[u]),P="input"===u?null:void 0,W=n((function(){return"function"==typeof h?h:j(h)}),[h]),N=l(),F=B(v,"id"),R=I(y,N),S=a(m),z=I(k,N),E=d(i),G=n((function(){return function(e){var o=e.data,n=e.formatValue,t=e.layout,i=e.alignFunction,r=e.sortFunction,l=e.linkSortMode,a=e.nodeThickness,d=e.nodeSpacing,c=e.nodeInnerPadding,s=e.width,u=e.height,h=e.getColor,v=e.getLabel,p=b().nodeAlign(i).nodeSort(r).linkSort(l).nodeWidth(a).nodePadding(d).size("horizontal"===t?[s,u]:[u,s]).nodeId(V),g=w(o);return p(g),g.nodes.forEach((function(e){if(e.color=h(e),e.label=v(e),e.formattedValue=n(e.value),"horizontal"===t)e.x=e.x0+c,e.y=e.y0,e.width=Math.max(e.x1-e.x0-2*c,0),e.height=Math.max(e.y1-e.y0,0);else{e.x=e.y0,e.y=e.x0+c,e.width=Math.max(e.y1-e.y0,0),e.height=Math.max(e.x1-e.x0-2*c,0);var o=e.x0,i=e.x1;e.x0=e.y0,e.x1=e.y1,e.y0=o,e.y1=i}})),g.links.forEach((function(e){e.formattedValue=n(e.value),e.color=e.source.color,e.pos0=e.y0,e.pos1=e.y1,e.thickness=e.width,delete e.y0,delete e.y1,delete e.width})),g}({data:t,formatValue:E,layout:r,alignFunction:W,sortFunction:H,linkSortMode:P,nodeThickness:p,nodeSpacing:g,nodeInnerPadding:f,width:c,height:s,getColor:F,getLabel:S})}),[t,E,r,W,H,P,p,g,f,c,s,F,S]),D=G.nodes,A=G.links,Z=n((function(){return D.map((function(e){return{id:e.id,label:e.label,color:e.color}}))}),[D]);return{nodes:D,links:A,legendData:Z,getNodeBorderColor:R,currentNode:x,setCurrentNode:O,currentLink:M,setCurrentLink:T,getLabelTextColor:z}},Z=function(e){var o=e.node,n=e.x,r=e.y,l=e.width,a=e.height,d=e.color,s=e.opacity,u=e.borderWidth,h=e.borderColor,v=e.borderRadius,p=e.setCurrent,g=e.isInteractive,f=e.onClick,y=e.tooltip,m=c(),k=m.animate,b=m.config,C=H({x:n,y:r,width:l,height:a,opacity:s,color:d,config:b,immediate:!k}),x=O(),M=x.showTooltipFromEvent,T=x.hideTooltip,w=t((function(e){p(o),M(i(y,{node:o}),e,"left")}),[p,o,M,y]),B=t((function(e){M(i(y,{node:o}),e,"left")}),[M,o,y]),I=t((function(){p(null),T()}),[p,T]),W=t((function(e){null==f||f(o,e)}),[f,o]);return L(P.rect,{x:C.x,y:C.y,rx:v,ry:v,width:C.width.to((function(e){return Math.max(e,0)})),height:C.height.to((function(e){return Math.max(e,0)})),fill:C.color,fillOpacity:C.opacity,strokeWidth:u,stroke:h,strokeOpacity:s,onMouseEnter:g?w:void 0,onMouseMove:g?B:void 0,onMouseLeave:g?I:void 0,onClick:g?W:void 0})},q=function(e){var o=e.nodes,n=e.nodeOpacity,t=e.nodeHoverOpacity,i=e.nodeHoverOthersOpacity,r=e.borderWidth,l=e.getBorderColor,a=e.borderRadius,d=e.setCurrentNode,c=e.currentNode,s=e.currentLink,u=e.isCurrentNode,h=e.isInteractive,v=e.onClick,p=e.tooltip,g=function(e){return c||s?u(e)?t:i:n};return L(T,{children:o.map((function(e){return L(Z,{node:e,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color,opacity:g(e),borderWidth:r,borderColor:l(e),borderRadius:a,setCurrent:d,isInteractive:h,onClick:v,tooltip:p},e.id)}))})},U=function(e){var o=e.id,n=e.layout,t=e.startColor,i=e.endColor;return M("linearGradient",S({id:o,spreadMethod:"pad"},"horizontal"===n?{x1:"0%",x2:"100%",y1:"0%",y2:"0%"}:{x1:"0%",x2:"0%",y1:"0%",y2:"100%"},{children:[L("stop",{offset:"0%",stopColor:t}),L("stop",{offset:"100%",stopColor:i})]}))},J=function(e){var o=e.link,n=e.layout,r=e.path,l=e.color,a=e.opacity,d=e.blendMode,u=e.enableGradient,h=e.setCurrent,v=e.tooltip,p=e.isInteractive,g=e.onClick,f=o.source.id+"."+o.target.id,y=c(),m=y.animate,k=y.config,b=s(r),C=H({color:l,opacity:a,config:k,immediate:!m}),x=O(),w=x.showTooltipFromEvent,B=x.hideTooltip,I=t((function(e){h(o),w(i(v,{link:o}),e,"left")}),[h,o,w,v]),W=t((function(e){w(i(v,{link:o}),e,"left")}),[w,o,v]),N=t((function(){h(null),B()}),[h,B]),F=t((function(e){null==g||g(o,e)}),[g,o]);return M(T,{children:[u&&L(U,{id:f,layout:n,startColor:o.startColor||o.source.color,endColor:o.endColor||o.target.color}),L(P.path,{fill:u?'url("#'+encodeURI(f)+'")':C.color,d:b,fillOpacity:C.opacity,onMouseEnter:p?I:void 0,onMouseMove:p?W:void 0,onMouseLeave:p?N:void 0,onClick:p?F:void 0,style:{mixBlendMode:d}})]})},K=function(e){var o=e.links,t=e.layout,i=e.linkOpacity,r=e.linkHoverOpacity,l=e.linkHoverOthersOpacity,a=e.linkContract,d=e.linkBlendMode,c=e.enableLinkGradient,s=e.setCurrentLink,u=e.currentLink,h=e.currentNode,v=e.isCurrentLink,p=e.isInteractive,g=e.onClick,f=e.tooltip,y=function(e){return h||u?v(e)?r:l:i},m=n((function(){return"horizontal"===t?(e=N().curve(F),function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.x0-o.source.x1),r=[[o.source.x1,o.pos0-t],[o.source.x1+i,o.pos0-t],[o.target.x0-i,o.pos1-t],[o.target.x0,o.pos1-t],[o.target.x0,o.pos1+t],[o.target.x0-i,o.pos1+t],[o.source.x1+i,o.pos0+t],[o.source.x1,o.pos0+t],[o.source.x1,o.pos0-t]];return e(r)+"Z"}):function(){var e=N().curve(R);return function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.y0-o.source.y1),r=[[o.pos0+t,o.source.y1],[o.pos0+t,o.source.y1+i],[o.pos1+t,o.target.y0-i],[o.pos1+t,o.target.y0],[o.pos1-t,o.target.y0],[o.pos1-t,o.target.y0-i],[o.pos0-t,o.source.y1+i],[o.pos0-t,o.source.y1],[o.pos0+t,o.source.y1]];return e(r)+"Z"}}();var e}),[t]);return L(T,{children:o.map((function(e){return L(J,{link:e,layout:t,path:m(e,a),color:e.color,opacity:y(e),blendMode:d,enableGradient:c,setCurrent:s,isInteractive:p,onClick:g,tooltip:f},e.source.id+"."+e.target.id)}))})},Q=function(e){var o=e.nodes,n=e.layout,t=e.width,i=e.height,r=e.labelPosition,a=e.labelPadding,d=e.labelOrientation,s=e.getLabelTextColor,u=l(),h="vertical"===d?-90:0,v=o.map((function(e){var o,l,c;return"horizontal"===n?(l=e.y+e.height/2,e.x<t/2?"inside"===r?(o=e.x1+a,c="vertical"===d?"middle":"start"):(o=e.x-a,c="vertical"===d?"middle":"end"):"inside"===r?(o=e.x-a,c="vertical"===d?"middle":"end"):(o=e.x1+a,c="vertical"===d?"middle":"start")):"vertical"===n&&(o=e.x+e.width/2,e.y<i/2?"inside"===r?(l=e.y1+a,c="vertical"===d?"end":"middle"):(l=e.y-a,c="vertical"===d?"start":"middle"):"inside"===r?(l=e.y-a,c="vertical"===d?"start":"middle"):(l=e.y1+a,c="vertical"===d?"end":"middle")),{id:e.id,label:e.label,x:o,y:l,textAnchor:c,color:s(e)}})),p=c(),g=p.animate,f=p.config,y=W(v.length,v.map((function(e){return{transform:"translate("+e.x+", "+e.y+") rotate("+h+")",color:e.color,config:f,immediate:!g}})));return L(T,{children:y.map((function(e,o){var n=v[o];return L(P.text,{dominantBaseline:"central",textAnchor:n.textAnchor,transform:e.transform,style:S({},u.labels.text,{fill:e.color,pointerEvents:"none"}),children:n.label},n.id)}))})},X=["isInteractive","animate","motionConfig","theme","renderWrapper"],Y=function(o){var n=o.data,t=o.valueFormat,l=o.layout,a=void 0===l?D.layout:l,d=o.sort,c=void 0===d?D.sort:d,s=o.align,u=void 0===s?D.align:s,p=o.width,f=o.height,y=o.margin,m=o.colors,k=void 0===m?D.colors:m,b=o.nodeThickness,C=void 0===b?D.nodeThickness:b,x=o.nodeSpacing,O=void 0===x?D.nodeThickness:x,M=o.nodeInnerPadding,T=void 0===M?D.nodeInnerPadding:M,w=o.nodeBorderColor,B=void 0===w?D.nodeBorderColor:w,I=o.nodeOpacity,H=void 0===I?D.nodeOpacity:I,P=o.nodeHoverOpacity,W=void 0===P?D.nodeHoverOpacity:P,N=o.nodeHoverOthersOpacity,F=void 0===N?D.nodeHoverOthersOpacity:N,R=o.nodeBorderWidth,z=void 0===R?D.nodeBorderWidth:R,E=o.nodeBorderRadius,G=void 0===E?D.nodeBorderRadius:E,j=o.linkOpacity,V=void 0===j?D.linkOpacity:j,Z=o.linkHoverOpacity,U=void 0===Z?D.linkHoverOpacity:Z,J=o.linkHoverOthersOpacity,X=void 0===J?D.linkHoverOthersOpacity:J,Y=o.linkContract,$=void 0===Y?D.linkContract:Y,_=o.linkBlendMode,ee=void 0===_?D.linkBlendMode:_,oe=o.enableLinkGradient,ne=void 0===oe?D.enableLinkGradient:oe,te=o.enableLabels,ie=void 0===te?D.enableLabels:te,re=o.labelPosition,le=void 0===re?D.labelPosition:re,ae=o.labelPadding,de=void 0===ae?D.labelPadding:ae,ce=o.labelOrientation,se=void 0===ce?D.labelOrientation:ce,ue=o.label,he=void 0===ue?D.label:ue,ve=o.labelTextColor,pe=void 0===ve?D.labelTextColor:ve,ge=o.nodeTooltip,fe=void 0===ge?D.nodeTooltip:ge,ye=o.linkTooltip,me=void 0===ye?D.linkTooltip:ye,ke=o.isInteractive,be=void 0===ke?D.isInteractive:ke,Ce=o.onClick,xe=o.legends,Oe=void 0===xe?D.legends:xe,Le=o.layers,Me=void 0===Le?D.layers:Le,Te=o.role,we=void 0===Te?D.role:Te,Be=o.ariaLabel,Ie=o.ariaLabelledBy,He=o.ariaDescribedBy,Pe=h(p,f,y),We=Pe.margin,Ne=Pe.innerWidth,Fe=Pe.innerHeight,Re=Pe.outerWidth,Se=Pe.outerHeight,ze=A({data:n,valueFormat:t,layout:a,width:Ne,height:Fe,sort:c,align:u,colors:k,nodeThickness:C,nodeSpacing:O,nodeInnerPadding:T,nodeBorderColor:B,label:he,labelTextColor:pe}),Ee=ze.nodes,Ge=ze.links,je=ze.legendData,De=ze.getNodeBorderColor,Ve=ze.currentNode,Ae=ze.setCurrentNode,Ze=ze.currentLink,qe=ze.setCurrentLink,Ue=ze.getLabelTextColor,Je=function(){return!1},Ke=function(){return!1};if(Ze&&(Je=function(e){var o=e.id;return o===Ze.source.id||o===Ze.target.id},Ke=function(e){var o=e.source,n=e.target;return o.id===Ze.source.id&&n.id===Ze.target.id}),Ve){var Qe=[Ve.id];Ge.filter((function(e){var o=e.source,n=e.target;return o.id===Ve.id||n.id===Ve.id})).forEach((function(e){var o=e.source,n=e.target;Qe.push(o.id),Qe.push(n.id)})),Qe=e(Qe),Je=function(e){var o=e.id;return Qe.includes(o)},Ke=function(e){var o=e.source,n=e.target;return o.id===Ve.id||n.id===Ve.id}}var Xe={links:Ge,nodes:Ee,margin:We,width:p,height:f,outerWidth:Re,outerHeight:Se},Ye={links:null,nodes:null,labels:null,legends:null};return Me.includes("links")&&(Ye.links=L(K,{links:Ge,layout:a,linkContract:$,linkOpacity:V,linkHoverOpacity:U,linkHoverOthersOpacity:X,linkBlendMode:ee,enableLinkGradient:ne,setCurrentLink:qe,currentNode:Ve,currentLink:Ze,isCurrentLink:Ke,isInteractive:be,onClick:Ce,tooltip:me},"links")),Me.includes("nodes")&&(Ye.nodes=L(q,{nodes:Ee,nodeOpacity:H,nodeHoverOpacity:W,nodeHoverOthersOpacity:F,borderWidth:z,borderRadius:G,getBorderColor:De,setCurrentNode:Ae,currentNode:Ve,currentLink:Ze,isCurrentNode:Je,isInteractive:be,onClick:Ce,tooltip:fe},"nodes")),Me.includes("labels")&&ie&&(Ye.labels=L(Q,{nodes:Ee,layout:a,width:Ne,height:Fe,labelPosition:le,labelPadding:de,labelOrientation:se,getLabelTextColor:Ue},"labels")),Me.includes("legends")&&(Ye.legends=L(r,{children:Oe.map((function(e,o){return L(g,S({},e,{containerWidth:Ne,containerHeight:Fe,data:je}),"legend"+o)}))},"legends")),L(v,{width:Re,height:Se,margin:We,role:we,ariaLabel:Be,ariaLabelledBy:Ie,ariaDescribedBy:He,children:Me.map((function(e,o){var n;return"function"==typeof e?L(r,{children:i(e,Xe)},o):null!=(n=null==Ye?void 0:Ye[e])?n:null}))})},$=function(e){var o=e.isInteractive,n=void 0===o?D.isInteractive:o,t=e.animate,i=void 0===t?D.animate:t,r=e.motionConfig,l=void 0===r?D.motionConfig:r,a=e.theme,d=e.renderWrapper,c=function(e,o){if(null==e)return{};var n,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||(i[n]=e[n]);return i}(e,X);return L(u,{animate:i,isInteractive:n,motionConfig:l,renderWrapper:d,theme:a,children:L(Y,S({isInteractive:n},c))})},_=function(e){return L(p,{children:function(o){var n=o.width,t=o.height;return L($,S({width:n,height:t},e))}})};export{_ as ResponsiveSankey,$ as Sankey,j as sankeyAlignmentFromProp,G as sankeyAlignmentPropKeys,E as sankeyAlignmentPropMapping,D as svgDefaultProps};
//# sourceMappingURL=nivo-sankey.es.js.map
