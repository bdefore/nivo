"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("lodash/uniq"),o=require("react"),n=require("@nivo/core"),t=require("@nivo/legends"),i=require("d3-sankey"),r=require("@nivo/tooltip"),a=require("react/jsx-runtime"),l=require("lodash/cloneDeep"),d=require("@nivo/colors"),s=require("@react-spring/web"),c=require("d3-shape");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=u(e),p=u(l);function v(){return v=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},v.apply(this,arguments)}var g={container:{display:"flex",alignItems:"center"},sourceChip:{marginRight:7},targetChip:{marginLeft:7,marginRight:7}},y={center:i.sankeyCenter,justify:i.sankeyJustify,start:i.sankeyLeft,end:i.sankeyRight},f=Object.keys(y),k=function(e){return y[e]},x={layout:"horizontal",align:"center",sort:"auto",colors:{scheme:"nivo"},nodeOpacity:.75,nodeHoverOpacity:1,nodeHoverOthersOpacity:.15,nodeThickness:12,nodeSpacing:12,nodeInnerPadding:0,nodeBorderWidth:1,nodeBorderColor:{from:"color",modifiers:[["darker",.5]]},nodeBorderRadius:0,linkOpacity:.25,linkHoverOpacity:.6,linkHoverOthersOpacity:.15,linkContract:0,linkBlendMode:"multiply",enableLinkGradient:!1,enableLabels:!0,label:"id",labelPosition:"inside",labelPadding:9,labelOrientation:"horizontal",labelTextColor:{from:"color",modifiers:[["darker",.8]]},isInteractive:!0,nodeTooltip:function(e){var o=e.node;return a.jsx(r.BasicTooltip,{id:o.label,enableChip:!0,color:o.color})},linkTooltip:function(e){var o=e.link;return a.jsx(r.BasicTooltip,{id:a.jsxs("span",{style:g.container,children:[a.jsx(r.Chip,{color:o.source.color,style:g.sourceChip}),a.jsx("strong",{children:o.source.label})," > ",a.jsx("strong",{children:o.target.label}),a.jsx(r.Chip,{color:o.target.color,style:g.targetChip}),a.jsx("strong",{children:o.formattedValue})]})})},legends:[],layers:["links","nodes","labels","legends"],role:"img",animate:!0,motionConfig:"gentle"},m=function(e){return e.id},b=function(e){var t=e.data,r=e.valueFormat,a=e.layout,l=e.width,s=e.height,c=e.sort,u=e.align,h=e.colors,v=e.nodeThickness,g=e.nodeSpacing,y=e.nodeInnerPadding,f=e.nodeBorderColor,x=e.label,b=e.labelTextColor,C=o.useState(null),O=C[0],j=C[1],M=o.useState(null),L=M[0],T=M[1],B=o.useMemo((function(){if("auto"!==c)return"input"===c?null:"ascending"===c?function(e,o){return e.value-o.value}:"descending"===c?function(e,o){return o.value-e.value}:c}),[c]),I="input"===c?null:void 0,w=o.useMemo((function(){return"function"==typeof u?u:k(u)}),[u]),P=n.useTheme(),H=d.useOrdinalColorScale(h,"id"),S=d.useInheritedColor(f,P),W=n.usePropertyAccessor(x),F=d.useInheritedColor(b,P),N=n.useValueFormatter(r),E=o.useMemo((function(){return function(e){var o=e.data,n=e.formatValue,t=e.layout,r=e.alignFunction,a=e.sortFunction,l=e.linkSortMode,d=e.nodeThickness,s=e.nodeSpacing,c=e.nodeInnerPadding,u=e.width,h=e.height,v=e.getColor,g=e.getLabel,y=i.sankey().nodeAlign(r).nodeSort(a).linkSort(l).nodeWidth(d).nodePadding(s).size("horizontal"===t?[u,h]:[h,u]).nodeId(m),f=p.default(o);return y(f),f.nodes.forEach((function(e){if(e.color=v(e),e.label=g(e),e.formattedValue=n(e.value),"horizontal"===t)e.x=e.x0+c,e.y=e.y0,e.width=Math.max(e.x1-e.x0-2*c,0),e.height=Math.max(e.y1-e.y0,0);else{e.x=e.y0,e.y=e.x0+c,e.width=Math.max(e.y1-e.y0,0),e.height=Math.max(e.x1-e.x0-2*c,0);var o=e.x0,i=e.x1;e.x0=e.y0,e.x1=e.y1,e.y0=o,e.y1=i}})),f.links.forEach((function(e){e.formattedValue=n(e.value),e.color=e.source.color,e.pos0=e.y0,e.pos1=e.y1,e.thickness=e.width,delete e.y0,delete e.y1,delete e.width})),f}({data:t,formatValue:N,layout:a,alignFunction:w,sortFunction:B,linkSortMode:I,nodeThickness:v,nodeSpacing:g,nodeInnerPadding:y,width:l,height:s,getColor:H,getLabel:W})}),[t,N,a,w,B,I,v,g,y,l,s,H,W]),R=E.nodes,q=E.links,A=o.useMemo((function(){return R.map((function(e){return{id:e.id,label:e.label,color:e.color}}))}),[R]);return{nodes:R,links:q,legendData:A,getNodeBorderColor:S,currentNode:O,setCurrentNode:j,currentLink:L,setCurrentLink:T,getLabelTextColor:F}},C=function(e){var t=e.node,i=e.x,l=e.y,d=e.width,c=e.height,u=e.color,h=e.opacity,p=e.borderWidth,v=e.borderColor,g=e.borderRadius,y=e.setCurrent,f=e.isInteractive,k=e.onClick,x=e.tooltip,m=n.useMotionConfig(),b=m.animate,C=m.config,O=s.useSpring({x:i,y:l,width:d,height:c,opacity:h,color:u,config:C,immediate:!b}),j=r.useTooltip(),M=j.showTooltipFromEvent,L=j.hideTooltip,T=o.useCallback((function(e){y(t),M(o.createElement(x,{node:t}),e,"left")}),[y,t,M,x]),B=o.useCallback((function(e){M(o.createElement(x,{node:t}),e,"left")}),[M,t,x]),I=o.useCallback((function(){y(null),L()}),[y,L]),w=o.useCallback((function(e){null==k||k(t,e)}),[k,t]);return a.jsx(s.animated.rect,{x:O.x,y:O.y,rx:g,ry:g,width:O.width.to((function(e){return Math.max(e,0)})),height:O.height.to((function(e){return Math.max(e,0)})),fill:O.color,fillOpacity:O.opacity,strokeWidth:p,stroke:v,strokeOpacity:h,onMouseEnter:f?T:void 0,onMouseMove:f?B:void 0,onMouseLeave:f?I:void 0,onClick:f?w:void 0})},O=function(e){var o=e.nodes,n=e.nodeOpacity,t=e.nodeHoverOpacity,i=e.nodeHoverOthersOpacity,r=e.borderWidth,l=e.getBorderColor,d=e.borderRadius,s=e.setCurrentNode,c=e.currentNode,u=e.currentLink,h=e.isCurrentNode,p=e.isInteractive,v=e.onClick,g=e.tooltip,y=function(e){return c||u?h(e)?t:i:n};return a.jsx(a.Fragment,{children:o.map((function(e){return a.jsx(C,{node:e,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color,opacity:y(e),borderWidth:r,borderColor:l(e),borderRadius:d,setCurrent:s,isInteractive:p,onClick:v,tooltip:g},e.id)}))})},j=function(e){var o,n=e.id,t=e.layout,i=e.startColor,r=e.endColor;return o="horizontal"===t?{x1:"0%",x2:"100%",y1:"0%",y2:"0%"}:{x1:"0%",x2:"0%",y1:"0%",y2:"100%"},a.jsxs("linearGradient",v({id:n,spreadMethod:"pad"},o,{children:[a.jsx("stop",{offset:"0%",stopColor:i}),a.jsx("stop",{offset:"100%",stopColor:r})]}))},M=function(e){var t=e.link,i=e.layout,l=e.path,d=e.color,c=e.opacity,u=e.blendMode,h=e.enableGradient,p=e.setCurrent,v=e.tooltip,g=e.isInteractive,y=e.onClick,f=t.source.id+"."+t.target.id,k=n.useMotionConfig(),x=k.animate,m=k.config,b=n.useAnimatedPath(l),C=s.useSpring({color:d,opacity:c,config:m,immediate:!x}),O=r.useTooltip(),M=O.showTooltipFromEvent,L=O.hideTooltip,T=o.useCallback((function(e){p(t),M(o.createElement(v,{link:t}),e,"left")}),[p,t,M,v]),B=o.useCallback((function(e){M(o.createElement(v,{link:t}),e,"left")}),[M,t,v]),I=o.useCallback((function(){p(null),L()}),[p,L]),w=o.useCallback((function(e){null==y||y(t,e)}),[y,t]);return a.jsxs(a.Fragment,{children:[h&&a.jsx(j,{id:f,layout:i,startColor:t.startColor||t.source.color,endColor:t.endColor||t.target.color}),a.jsx(s.animated.path,{fill:h?'url("#'+encodeURI(f)+'")':C.color,d:b,fillOpacity:C.opacity,onMouseEnter:g?T:void 0,onMouseMove:g?B:void 0,onMouseLeave:g?I:void 0,onClick:g?w:void 0,style:{mixBlendMode:u}})]})},L=function(e){var n=e.links,t=e.layout,i=e.linkOpacity,r=e.linkHoverOpacity,l=e.linkHoverOthersOpacity,d=e.linkContract,s=e.linkBlendMode,u=e.enableLinkGradient,h=e.setCurrentLink,p=e.currentLink,v=e.currentNode,g=e.isCurrentLink,y=e.isInteractive,f=e.onClick,k=e.tooltip,x=function(e){return v||p?g(e)?r:l:i},m=o.useMemo((function(){return"horizontal"===t?(e=c.line().curve(c.curveMonotoneX),function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.x0-o.source.x1),r=[[o.source.x1,o.pos0-t],[o.source.x1+i,o.pos0-t],[o.target.x0-i,o.pos1-t],[o.target.x0,o.pos1-t],[o.target.x0,o.pos1+t],[o.target.x0-i,o.pos1+t],[o.source.x1+i,o.pos0+t],[o.source.x1,o.pos0+t],[o.source.x1,o.pos0-t]];return e(r)+"Z"}):function(){var e=c.line().curve(c.curveMonotoneY);return function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.y0-o.source.y1),r=[[o.pos0+t,o.source.y1],[o.pos0+t,o.source.y1+i],[o.pos1+t,o.target.y0-i],[o.pos1+t,o.target.y0],[o.pos1-t,o.target.y0],[o.pos1-t,o.target.y0-i],[o.pos0-t,o.source.y1+i],[o.pos0-t,o.source.y1],[o.pos0+t,o.source.y1]];return e(r)+"Z"}}();var e}),[t]);return a.jsx(a.Fragment,{children:n.map((function(e){return a.jsx(M,{link:e,layout:t,path:m(e,d),color:e.color,opacity:x(e),blendMode:s,enableGradient:u,setCurrent:h,isInteractive:y,onClick:f,tooltip:k},e.source.id+"."+e.target.id)}))})},T=function(e){var o=e.nodes,t=e.layout,i=e.width,r=e.height,l=e.labelPosition,d=e.labelPadding,c=e.labelOrientation,u=e.getLabelTextColor,h=n.useTheme(),p="vertical"===c?-90:0,g=o.map((function(e){var o,n,a;return"horizontal"===t?(n=e.y+e.height/2,e.x<i/2?"inside"===l?(o=e.x1+d,a="vertical"===c?"middle":"start"):(o=e.x-d,a="vertical"===c?"middle":"end"):"inside"===l?(o=e.x-d,a="vertical"===c?"middle":"end"):(o=e.x1+d,a="vertical"===c?"middle":"start")):"vertical"===t&&(o=e.x+e.width/2,e.y<r/2?"inside"===l?(n=e.y1+d,a="vertical"===c?"end":"middle"):(n=e.y-d,a="vertical"===c?"start":"middle"):"inside"===l?(n=e.y-d,a="vertical"===c?"start":"middle"):(n=e.y1+d,a="vertical"===c?"end":"middle")),{id:e.id,label:e.label,x:o,y:n,textAnchor:a,color:u(e)}})),y=n.useMotionConfig(),f=y.animate,k=y.config,x=s.useSprings(g.length,g.map((function(e){return{transform:"translate("+e.x+", "+e.y+") rotate("+p+")",color:e.color,config:k,immediate:!f}})));return a.jsx(a.Fragment,{children:x.map((function(e,o){var n=g[o];return a.jsx(s.animated.text,{dominantBaseline:"central",textAnchor:n.textAnchor,transform:e.transform,style:v({},h.labels.text,{fill:e.color,pointerEvents:"none"}),children:n.label},n.id)}))})},B=["isInteractive","animate","motionConfig","theme","renderWrapper"],I=function(e){var i=e.data,r=e.valueFormat,l=e.layout,d=void 0===l?x.layout:l,s=e.sort,c=void 0===s?x.sort:s,u=e.align,p=void 0===u?x.align:u,g=e.width,y=e.height,f=e.margin,k=e.colors,m=void 0===k?x.colors:k,C=e.nodeThickness,j=void 0===C?x.nodeThickness:C,M=e.nodeSpacing,B=void 0===M?x.nodeThickness:M,I=e.nodeInnerPadding,w=void 0===I?x.nodeInnerPadding:I,P=e.nodeBorderColor,H=void 0===P?x.nodeBorderColor:P,S=e.nodeOpacity,W=void 0===S?x.nodeOpacity:S,F=e.nodeHoverOpacity,N=void 0===F?x.nodeHoverOpacity:F,E=e.nodeHoverOthersOpacity,R=void 0===E?x.nodeHoverOthersOpacity:E,q=e.nodeBorderWidth,A=void 0===q?x.nodeBorderWidth:q,z=e.nodeBorderRadius,G=void 0===z?x.nodeBorderRadius:z,D=e.linkOpacity,V=void 0===D?x.linkOpacity:D,Z=e.linkHoverOpacity,_=void 0===Z?x.linkHoverOpacity:Z,J=e.linkHoverOthersOpacity,K=void 0===J?x.linkHoverOthersOpacity:J,U=e.linkContract,X=void 0===U?x.linkContract:U,Y=e.linkBlendMode,Q=void 0===Y?x.linkBlendMode:Y,$=e.enableLinkGradient,ee=void 0===$?x.enableLinkGradient:$,oe=e.enableLabels,ne=void 0===oe?x.enableLabels:oe,te=e.labelPosition,ie=void 0===te?x.labelPosition:te,re=e.labelPadding,ae=void 0===re?x.labelPadding:re,le=e.labelOrientation,de=void 0===le?x.labelOrientation:le,se=e.label,ce=void 0===se?x.label:se,ue=e.labelTextColor,he=void 0===ue?x.labelTextColor:ue,pe=e.nodeTooltip,ve=void 0===pe?x.nodeTooltip:pe,ge=e.linkTooltip,ye=void 0===ge?x.linkTooltip:ge,fe=e.isInteractive,ke=void 0===fe?x.isInteractive:fe,xe=e.onClick,me=e.legends,be=void 0===me?x.legends:me,Ce=e.layers,Oe=void 0===Ce?x.layers:Ce,je=e.role,Me=void 0===je?x.role:je,Le=e.ariaLabel,Te=e.ariaLabelledBy,Be=e.ariaDescribedBy,Ie=n.useDimensions(g,y,f),we=Ie.margin,Pe=Ie.innerWidth,He=Ie.innerHeight,Se=Ie.outerWidth,We=Ie.outerHeight,Fe=b({data:i,valueFormat:r,layout:d,width:Pe,height:He,sort:c,align:p,colors:m,nodeThickness:j,nodeSpacing:B,nodeInnerPadding:w,nodeBorderColor:H,label:ce,labelTextColor:he}),Ne=Fe.nodes,Ee=Fe.links,Re=Fe.legendData,qe=Fe.getNodeBorderColor,Ae=Fe.currentNode,ze=Fe.setCurrentNode,Ge=Fe.currentLink,De=Fe.setCurrentLink,Ve=Fe.getLabelTextColor,Ze=function(){return!1},_e=function(){return!1};if(Ge&&(Ze=function(e){var o=e.id;return o===Ge.source.id||o===Ge.target.id},_e=function(e){var o=e.source,n=e.target;return o.id===Ge.source.id&&n.id===Ge.target.id}),Ae){var Je=[Ae.id];Ee.filter((function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id})).forEach((function(e){var o=e.source,n=e.target;Je.push(o.id),Je.push(n.id)})),Je=h.default(Je),Ze=function(e){var o=e.id;return Je.includes(o)},_e=function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id}}var Ke={links:Ee,nodes:Ne,margin:we,width:g,height:y,outerWidth:Se,outerHeight:We},Ue={links:null,nodes:null,labels:null,legends:null};return Oe.includes("links")&&(Ue.links=a.jsx(L,{links:Ee,layout:d,linkContract:X,linkOpacity:V,linkHoverOpacity:_,linkHoverOthersOpacity:K,linkBlendMode:Q,enableLinkGradient:ee,setCurrentLink:De,currentNode:Ae,currentLink:Ge,isCurrentLink:_e,isInteractive:ke,onClick:xe,tooltip:ye},"links")),Oe.includes("nodes")&&(Ue.nodes=a.jsx(O,{nodes:Ne,nodeOpacity:W,nodeHoverOpacity:N,nodeHoverOthersOpacity:R,borderWidth:A,borderRadius:G,getBorderColor:qe,setCurrentNode:ze,currentNode:Ae,currentLink:Ge,isCurrentNode:Ze,isInteractive:ke,onClick:xe,tooltip:ve},"nodes")),Oe.includes("labels")&&ne&&(Ue.labels=a.jsx(T,{nodes:Ne,layout:d,width:Pe,height:He,labelPosition:ie,labelPadding:ae,labelOrientation:de,getLabelTextColor:Ve},"labels")),Oe.includes("legends")&&(Ue.legends=a.jsx(o.Fragment,{children:be.map((function(e,o){return a.jsx(t.BoxLegendSvg,v({},e,{containerWidth:Pe,containerHeight:He,data:Re}),"legend"+o)}))},"legends")),a.jsx(n.SvgWrapper,{width:Se,height:We,margin:we,role:Me,ariaLabel:Le,ariaLabelledBy:Te,ariaDescribedBy:Be,children:Oe.map((function(e,n){var t;return"function"==typeof e?a.jsx(o.Fragment,{children:o.createElement(e,Ke)},n):null!=(t=null==Ue?void 0:Ue[e])?t:null}))})},w=function(e){var o=e.isInteractive,t=void 0===o?x.isInteractive:o,i=e.animate,r=void 0===i?x.animate:i,l=e.motionConfig,d=void 0===l?x.motionConfig:l,s=e.theme,c=e.renderWrapper,u=function(e,o){if(null==e)return{};var n,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||(i[n]=e[n]);return i}(e,B);return a.jsx(n.Container,{animate:r,isInteractive:t,motionConfig:d,renderWrapper:c,theme:s,children:a.jsx(I,v({isInteractive:t},u))})};exports.ResponsiveSankey=function(e){return a.jsx(n.ResponsiveWrapper,{children:function(o){var n=o.width,t=o.height;return a.jsx(w,v({width:n,height:t},e))}})},exports.Sankey=w,exports.sankeyAlignmentFromProp=k,exports.sankeyAlignmentPropKeys=f,exports.sankeyAlignmentPropMapping=y,exports.svgDefaultProps=x;
//# sourceMappingURL=nivo-sankey.cjs.js.map
